<div class="content-management-container">
  <!-- Header Section -->
  <div class="header">
    <div class="header-content">
      <div class="logo-section">
        <img src="assets/images/bcflats.png" alt="BC Flats Logo" class="header-logo">
      </div>
      <div class="title-section">
        <h1>Content Management Dashboard</h1>
        <p>Manage your website content, images, and text from one central location</p>
      </div>
      <div class="header-actions">
        <button type="button" 
                (click)="createBackup()" 
                class="backup-btn"
                [disabled]="!hasBackup"
                title="Create backup of current content">
          <i class="fa fa-save"></i> Backup Content
        </button>
        <button type="button" 
                (click)="globalReset()" 
                class="global-reset-btn"
                title="Reset all content to original state">
          <i class="fa fa-undo"></i> Reset All
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-spinner" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading your content...</p>
  </div>

  <!-- Main Content -->
  <div class="content-sections" *ngIf="!loading">
    
    <!-- Quick Actions Bar -->
    <div class="quick-actions-bar">
      <div class="quick-actions-content">
        <div class="quick-actions-info">
          <i class="fa fa-lightbulb"></i>
          <span>Quick Actions: Use these tools to manage your content efficiently</span>
        </div>
        <div class="quick-actions-buttons">
          <button type="button" 
                  (click)="refreshContent()" 
                  class="quick-btn refresh-btn"
                  title="Refresh content">
            <i class="fa fa-refresh"></i> Refresh
          </button>
          <button type="button" 
                  (click)="exportContent()" 
                  class="quick-btn export-btn"
                  title="Export content data">
            <i class="fa fa-download"></i> Export
          </button>
        </div>
    </div>

    <!-- Logo Management Section -->
    <div class="section-card logo-section-card">
      <div class="section-header">
        <div class="section-icon">
          <i class="fa fa-image"></i>
        </div>
        <div class="section-title">
          <h2>Website Logo</h2>
          <p>Update your main website logo that appears in the header</p>
        <div class="section-location">
          <i class="fa fa-map-marker-alt"></i>
            <span>Appears in: Website header (top of every page)</span>
          </div>
        </div>
      </div>
      
      <div class="logo-content">
        <!-- Current Logo Display -->
        <div class="current-logo-display" *ngIf="getCurrentLogo()">
          <h3>Current Logo</h3>
          <div class="logo-preview-container">
        <img [src]="getCurrentLogo()" alt="Current Logo" class="logo-preview">
            <div class="logo-info">
              <span class="logo-status active">Active</span>
              <span class="logo-size">Displayed on all pages</span>
            </div>
          </div>
      </div>

        <!-- Logo Upload -->
        <div class="logo-upload-container">
          <h3>Update Logo</h3>
          <div class="upload-instructions">
            <i class="fa fa-info-circle"></i>
            <span>Recommended: PNG or JPG format, max 2MB, transparent background preferred</span>
          </div>
          
          <div class="file-upload-area">
            <div class="file-input-wrapper">
              <input type="file" 
                     id="logo-upload" 
                 (change)="onFileSelected($event, 'logo')" 
                 accept="image/*" 
                 class="file-input">
              <label for="logo-upload" class="file-input-label">
                <i class="fa fa-cloud-upload"></i>
                <span>Choose Logo File</span>
              </label>
            </div>
            
            <div class="file-selected-info" *ngIf="selectedLogo">
              <div class="file-details">
                <i class="fa fa-file-image-o"></i>
                <div class="file-info-text">
                  <span class="file-name">{{ selectedLogo.name }}</span>
                  <span class="file-size">{{ getFileSize(selectedLogo) }}</span>
                </div>
              </div>
              <button type="button" 
                      (click)="clearLogoSelection()" 
                      class="clear-selection-btn"
                      title="Clear selected file">
                <i class="fa fa-times"></i>
              </button>
          </div>
        </div>
        
          <div class="upload-actions">
        <button type="button" 
                (click)="uploadLogo()" 
                [disabled]="!selectedLogo || uploading" 
                    class="primary-btn upload-btn">
              <i class="fa fa-upload"></i>
              <span *ngIf="!uploading">Upload New Logo</span>
          <span *ngIf="uploading">Uploading...</span>
        </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Sections -->
    <div class="section-card" *ngFor="let section of sections; trackBy: trackBySection">
      <div class="section-header">
        <div class="section-icon">
          <i [class]="getSectionIcon(section.id)"></i>
        </div>
        <div class="section-title">
        <h2>{{ section.name }}</h2>
        <p>{{ section.description }}</p>
        <div class="section-location">
          <i class="fa fa-map-marker-alt"></i>
            <span>Appears in: {{ getSectionLocation(section.id) }}</span>
          </div>
        </div>
        <div class="section-status">
          <span class="status-badge" [class]="getSectionStatusClass(section.id)">
            {{ getSectionStatus(section.id) }}
          </span>
        </div>
      </div>

      <!-- Section Content Tabs -->
      <div class="section-tabs">
        <div class="tab-buttons">
          <button type="button" 
                  class="tab-btn active" 
                  (click)="setActiveTab(section.id, 'text')"
                  [class.active]="getActiveTab(section.id) === 'text'">
            <i class="fa fa-font"></i> Text Content
          </button>
          <button type="button" 
                  class="tab-btn" 
                  (click)="setActiveTab(section.id, 'images')"
                  [class.active]="getActiveTab(section.id) === 'images'">
            <i class="fa fa-image"></i> Images
          </button>
          <button type="button" 
                  class="tab-btn" 
                  (click)="setActiveTab(section.id, 'gallery')"
                  [class.active]="getActiveTab(section.id) === 'gallery'"
                  *ngIf="section.id === 'hero' || section.id === 'rooms'">
            <i class="fa fa-th"></i> Gallery
          </button>
        </div>

        <!-- Text Content Tab -->
        <div class="tab-content" *ngIf="getActiveTab(section.id) === 'text'">
          <div class="current-vs-edit">
            <div class="current-block">
              <h4>Current Content</h4>
              <div class="content-grid">
                <div class="content-item" *ngFor="let item of getSectionContentOrSample(section.id)">
                  <img *ngIf="item.type === 'image' || item.type === 'logo'" [src]="item.optimizedUrl || item.value" class="content-image"/>
                  <div *ngIf="item.type === 'text'" class="text-preview">
                    <strong>{{ item.key }}</strong>
                    <div>{{ item.value }}</div>
                  </div>
                  <div class="meta">Key: {{ item.key }} | Type: {{ item.type }}</div>
                </div>
              </div>
            </div>
            
            </div>
          <div class="text-content-editor">
            <div class="editor-header">
              <h3>Edit Text Content</h3>
              <div class="editor-actions">
                <button type="button" 
                        (click)="resetSectionText(section.id)" 
                        class="secondary-btn reset-btn"
                        title="Reset to current values">
                  <i class="fa fa-undo"></i> Reset
                </button>
            <button type="button"
                        (click)="saveAllText(section.id)" 
                        class="primary-btn save-btn"
                    [disabled]="uploading"
                        title="Save all changes">
                  <i class="fa fa-save"></i> Save All
                </button>
              </div>
            </div>

            <div class="text-inputs-grid">
              <div class="text-input-group" *ngFor="let field of getTextFields(section.id)">
                <label [for]="'text-' + section.id + '-' + field.key">{{ field.label }}</label>
                <div class="input-wrapper">
                  <div class="current-value-pill" *ngIf="getCurrentContentWithFallback(section.id, field.key)">
                    <i class="fa fa-eye"></i>
                    <span><strong>Current:</strong> {{ getCurrentContentWithFallback(section.id, field.key) }}</span>
                  </div>
                  <input *ngIf="field.type === 'input'" 
                         type="text"
                         [id]="'text-' + section.id + '-' + field.key"
                         [(ngModel)]="textContent[section.id + '_' + field.key]"
                         [placeholder]="field.placeholder"
                         class="text-input">
                  <textarea *ngIf="field.type === 'textarea'" 
                           [id]="'text-' + section.id + '-' + field.key"
                           [(ngModel)]="textContent[section.id + '_' + field.key]"
                           [placeholder]="field.placeholder"
                           rows="3"
                           class="text-textarea"></textarea>
                  
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

        <!-- Images Tab -->
        <div class="tab-content" *ngIf="getActiveTab(section.id) === 'images'">
          <div class="hint">Select a file to replace an existing image or click Upload Image to add one. Keys are shown on each tile.</div>
          <div class="images-manager">
            <div class="images-header" (dragover)="onDragOver($event)" (drop)="onDropFile($event, 'image')">
              <h3>Manage Images</h3>
              <div class="images-actions">
                <button type="button" 
                        (click)="uploadSectionImage(section.id)" 
                        class="primary-btn upload-btn"
                        [disabled]="!selectedFile || uploading">
                  <i class="fa fa-upload"></i> Upload Image
                </button>
              </div>
            </div>

            <!-- Current Images -->
            <div class="current-images" *ngIf="hasImageContent(section.id)">
              <h4>Current Images</h4>
              <div class="images-grid">
                <div class="image-item" *ngFor="let item of getImageContent(section.id)">
                  <div class="image-preview">
            <img [src]="item.optimizedUrl || item.value" 
                 [alt]="item.altText || item.key"
                         class="content-image">
                    <div class="image-overlay">
                      <button type="button" 
                              (click)="replaceImage(section.id, item.key)"
                              class="delete-image-btn"
                              title="Replace with selected file" [disabled]="!selectedFile || uploading">
                        <i class="fa fa-refresh"></i>
                      </button>
                      <button type="button" 
                              (click)="deleteContent(item.id!)" 
                              class="delete-image-btn"
                              title="Delete image">
                        <i class="fa fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="image-details">
                    <span class="image-key">{{ formatImageKey(item.key) }}</span>
              <span class="image-alt" *ngIf="item.altText">{{ item.altText }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Image Upload -->
            <div class="image-upload-area" (dragover)="onDragOver($event)" (drop)="onDropFile($event, 'image')">
              <h4>Upload New Image</h4>
              <div class="upload-instructions">
                <i class="fa fa-info-circle"></i>
                <span>Select an image file to upload for this section</span>
              </div>
              
              <div class="file-upload-controls">
                <div class="file-input-wrapper">
            <input type="file" 
                   [id]="'image-upload-' + section.id"
                   (change)="onFileSelected($event, 'image')" 
                   accept="image/*" 
                   class="file-input">
                  <label [for]="'image-upload-' + section.id" class="file-input-label">
                    <i class="fa fa-cloud-upload"></i>
                    <span>Choose Image</span>
                  </label>
                </div>
                
                <div class="file-selected-info" *ngIf="selectedFile">
                  <div class="file-details">
                    <i class="fa fa-file-image-o"></i>
                    <div class="file-info-text">
                      <span class="file-name">{{ selectedFile.name }}</span>
                      <span class="file-size">{{ getFileSize(selectedFile) }}</span>
            </div>
          </div>
                  <img *ngIf="selectedPreviewUrl" [src]="selectedPreviewUrl" class="preview-thumb" alt="Preview"/>
            <button type="button" 
                          (click)="clearFileSelection()" 
                          class="clear-selection-btn"
                          title="Clear selected file">
                    <i class="fa fa-times"></i>
            </button>
        </div>
      </div>

              <div class="upload-form" *ngIf="selectedFile">
                <div class="form-group">
                  <label for="alt-text">Alt Text (Optional)</label>
                  <input type="text" 
                         id="alt-text"
                         [(ngModel)]="altText" 
                         placeholder="Describe the image for accessibility" 
                         class="alt-text-input">
            </div>
          </div>
        </div>
      </div>

          <!-- Hero specific trio editor with fixed keys -->
          <div *ngIf="section.id === 'hero'" class="hero-trio-editor">
            <h4>Hero Slides (Fixed Keys)</h4>
            <div class="images-grid">
              <div class="image-item" *ngFor="let idx of [1,2,3]">
                <div class="image-preview">
                  <img [src]="getCurrentContent('hero', 'hero-image-' + idx, 'image') || 'assets/images/placeholder.jpg'" class="content-image"/>
                  <div class="image-overlay">
                    <button type="button" 
                            (click)="replaceImage('hero', 'hero-image-' + idx)"
                            class="delete-image-btn"
                            [disabled]="!selectedFile || uploading"
                            title="Replace hero-image-{{idx}} with selected file">
                      <i class="fa fa-refresh"></i>
                    </button>
                  </div>
                </div>
                <div class="image-details">
                  <span class="image-key">hero-image-{{idx}}</span>
                  <div class="file-upload-controls small">
                    <div class="file-input-wrapper">
                      <input type="file" (change)="onFileSelected($event, 'image')" accept="image/*" class="file-input">
                      <label class="file-input-label"><i class="fa fa-cloud-upload"></i><span>Choose Image</span></label>
              </div>
            </div>
                </div>
            </div>
          </div>
        </div>
      </div>

        <!-- Gallery Tab -->
        <div class="tab-content" *ngIf="getActiveTab(section.id) === 'gallery' && (section.id === 'hero' || section.id === 'rooms')">
          <div class="gallery-manager">
            <div class="gallery-header">
              <h3>Gallery Management</h3>
              <div class="gallery-actions">
                <button type="button" 
                        (click)="uploadGalleryImages(section.id)" 
                        class="primary-btn upload-btn"
                        [disabled]="selectedGalleryFiles.length === 0 || uploading">
                  <i class="fa fa-upload"></i> Upload Images
                </button>
        </div>
      </div>

            <!-- Gallery Upload -->
            <div class="gallery-upload-area">
              <h4>Upload Multiple Images</h4>
              <div class="upload-instructions">
                <i class="fa fa-info-circle"></i>
                <span>Select multiple images to create a gallery for this section</span>
              </div>
              
              <div class="file-upload-controls">
                <div class="file-input-wrapper">
            <input type="file" 
                   [id]="'gallery-upload-' + section.id"
                   (change)="onFileSelected($event, 'gallery')" 
                   accept="image/*" 
                   multiple 
                   class="file-input">
                  <label [for]="'gallery-upload-' + section.id" class="file-input-label">
                    <i class="fa fa-cloud-upload"></i>
                    <span>Choose Multiple Images</span>
                  </label>
          </div>
          
                <div class="files-selected-info" *ngIf="selectedGalleryFiles.length > 0">
                  <div class="files-summary">
                    <i class="fa fa-images"></i>
                    <span>{{ selectedGalleryFiles.length }} image(s) selected</span>
                  </div>
          <button type="button" 
                          (click)="clearGallerySelection()" 
                          class="clear-selection-btn"
                          title="Clear selected files">
                    <i class="fa fa-times"></i>
          </button>
                </div>
              </div>
            </div>

            <!-- Current Gallery -->
            <div class="current-gallery" *ngIf="hasGalleryContent(section.id)">
              <h4>Current Gallery</h4>
              <div class="gallery-grid">
                <div class="gallery-item" *ngFor="let item of getGalleryContent(section.id)">
                  <div class="gallery-preview">
                    <img [src]="item.optimizedUrl || item.value" 
                         [alt]="item.altText || item.key"
                         class="gallery-image">
                    <div class="gallery-overlay">
                      <button type="button" 
                              (click)="deleteContent(item.id!)" 
                              class="delete-gallery-btn"
                              title="Delete image">
                        <i class="fa fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="gallery-details">
                    <span class="gallery-order">#{{ item.order || 1 }}</span>
                    <span class="gallery-alt" *ngIf="item.altText">{{ item.altText }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Section -->
    <div class="help-section">
      <div class="help-content">
        <div class="help-icon">
          <i class="fa fa-question-circle"></i>
        </div>
        <div class="help-text">
          <h3>Need Help?</h3>
          <p>Here are some tips to help you manage your content effectively:</p>
          <ul class="help-tips">
            <li><strong>Text Content:</strong> Update titles, descriptions, and other text elements</li>
            <li><strong>Images:</strong> Upload new images to replace existing ones</li>
            <li><strong>Gallery:</strong> Manage multiple images for hero and rooms sections</li>
            <li><strong>Logo:</strong> Update your website logo from the top section</li>
            <li><strong>Reset:</strong> Use the reset button to restore original content</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
