<div class="calendar-sudlanan" tabindex="0" (keydown)="onKeyDown($event)">
  <div class="calendar-h">
    <h1>Calendar View</h1>
    <p class="text-gray-600">Manage room bookings and availability</p>
  </div>

  <div class="calendar-content">
    <!-- Navigation Controls -->
    <div class="calendar-navigation">
      <div class="nav-controls">
        <button 
          class="nav-button" 
          (click)="goToPrevious()" 
          [disabled]="!canGoPrevious"
          title="Go to previous 14 days (Left Arrow)">
          <i class="fa fa-chevron-left"></i>
          Previous
        </button>
        
        <button 
          class="nav-button today-button" 
          (click)="goToToday()"
          title="Go to today (Home key)">
          <i class="fa fa-calendar-day"></i>
          Today
        </button>
        
        <button 
          class="nav-button" 
          (click)="goToNext()" 
          [disabled]="!canGoNext"
          title="Go to next 14 days (Right Arrow)">
          Next
          <i class="fa fa-chevron-right"></i>
        </button>
      </div>
      
      <div class="date-range-display">
        <span class="date-range-text">{{ currentDateRangeText }}</span>
      </div>
    </div>

    <div class="button-group">
      <button
        *ngFor="let type of roomTypes"
        (click)="setSelectedType(type.type)"
        [ngClass]="{ 'selected': type.type === selectedType }"
        class="type-button">
        {{ type.type }}
      </button>
    </div>

    <div class="calendar-legend">
      <div class="legend-item">
        <span class="legend-color legend-reserved"></span>
        <span class="legend-text">Reserved (Guaranteed / Not Guaranteed)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color legend-occupied"></span>
        <span class="legend-text">Occupied</span>
      </div>
      <div class="legend-item">
        <span class="legend-color legend-maintenance"></span>
        <span class="legend-text">Others</span>
      </div>
    </div>

  <div class="calendar-container">
    <table class="calendar-table">
      <thead>
        <tr>
          <th class="calendar-header">Room</th>
          <th *ngFor="let date of visibleDates" class="calendar-header">
            {{ date | date: 'MMM d' }}<br>
            <small>{{ date | date: 'EEE' }}</small>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let room of filteredRooms" 
            [class.out-of-service-row]="isRoomOutOfService(room)">

          <td class="calendar-cell room-info">
            Room {{ room.roomNumber }}
          </td>

          <ng-container *ngIf="isRoomOutOfService(room); else calendarCells">
            <td class="calendar-cell out-of-service-label" [attr.colspan]="visibleDates.length">
              {{ room.roomStatus }}
            </td>
          </ng-container>

          <ng-template #calendarCells>
            <ng-container *ngFor="let cell of getRowCells(room)">
              <td *ngIf="cell.type === 'empty'" class="calendar-cell booking-cell"></td>
              <td *ngIf="cell.type === 'booking'"
                  class="calendar-cell booking-cell"
                  [attr.colspan]="cell.colspan">
                <div class="booking-block"
                    cdkDrag
                    (cdkDragEnded)="onDragEnd($event, cell.booking!, room)"
                    (mousedown)="dragStart = true"
                    (mouseup)="onClickBooking(cell.booking, room)"
                    [ngClass]="{
                      'booking-reserved': cell.booking?.status === 'reserved',
                      'booking-occupied': cell.booking?.status === 'checked_in',
                      'booking-maintenance': isMaintenance(cell)
                    }"
                    style="cursor: pointer;">
                  {{ cell.booking?.guest?.first_name || '' }} {{ cell.booking?.guest?.last_name || cell.booking?.requests || '' }}
                </div>
              </td>
            </ng-container>
          </ng-template>
          </tr>
      </tbody>
    </table>
  </div>

  <!-- Booking Details Modal -->
  <app-booking-modal
    *ngIf="showModal"
    [booking]="selectedBooking"
    [room]="selectedRoom"
    (close)="closeBookingModal()">
  </app-booking-modal>
</div>
</div>