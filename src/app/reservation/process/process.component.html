<!-- Policy Modal -->
        <app-consent-policy-modal
          [isOpen]="showPolicyModal"
          (closed)="closePolicyModal()">
        </app-consent-policy-modal>
<!-- Main Form Container -->
<div class="form-container">
  <!-- Left Image Section -->
  <div class="left-side">
    <div class="overlay"></div>
    <img src="assets/images/about-img-2.jpg" alt="Guest" />
  </div>
  
  <!-- Right Form Section -->
  <div class="right-side">
    <div class="form-box">
      <h2>Guest Details</h2>
      <p class="selected-room">
        Selected Room: <strong>{{ selectedRoomType?.type }}</strong>
      </p>

      <form [formGroup]="customerForm" (ngSubmit)="submitFormWithLoading()">
        
        <!-- First Name -->
        <div class="form-group">
          <input type="text" placeholder="First Name" formControlName="firstName"
            (focus)="onFieldFocus('firstName')" (blur)="onFieldBlur('firstName')" (input)="onFieldChange('firstName')"
            (input)="capitalizeFirstLetter('firstName')"
            [class.error]="hasError('firstName')" [class.valid]="isValid('firstName')" />
          <div class="error-message" *ngIf="hasError('firstName')">{{ getErrorMessage('firstName') }}</div>
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <input type="text" placeholder="Last Name" formControlName="lastName"
            (focus)="onFieldFocus('lastName')" (blur)="onFieldBlur('lastName')" (input)="onFieldChange('lastName')"
            (input)="capitalizeFirstLetter('lastName')"
            [class.error]="hasError('lastName')" [class.valid]="isValid('lastName')" />
          <div class="error-message" *ngIf="hasError('lastName')">{{ getErrorMessage('lastName') }}</div>
        </div>

        <!-- Email -->
        <div class="form-group">
          <input type="email" placeholder="Email (Gmail only)" formControlName="email"
            (focus)="onFieldFocus('email')" (blur)="onFieldBlur('email')" (input)="onFieldChange('email')"
            [class.error]="hasError('email')" [class.valid]="isValid('email')" />
          <div class="error-message" *ngIf="hasError('email')">{{ getErrorMessage('email') }}</div>
          <div class="loading-message" *ngIf="customerForm.get('email')?.pending">
            <i class="fa fa-spinner fa-spin"></i> Checking email availability...
          </div>
        </div>

        <!-- Phone Number with Veriphone Validation -->
        <div class="form-group">
          <input type="tel" placeholder="Contact Number (+63XXXXXXXXXX)" formControlName="phone"
            (focus)="onFieldFocus('phone')" (blur)="onFieldBlur('phone')" (input)="formatPhoneNumber($event)"
            maxlength="13"
            [class.error]="hasError('phone')" [class.valid]="isValid('phone')" />
          
          <div class="error-message" *ngIf="hasError('phone')">{{ getErrorMessage('phone') }}</div>

          <!-- Loading indicator -->
          <div class="loading-message" *ngIf="phoneChecking">
            <i class="fa fa-spinner fa-spin"></i> Validating phone number...
          </div>

          <!-- Validation result -->
          <div class="success-message" *ngIf="phoneValid === true">
            ‚úÖ Phone number is valid
          </div>
          <div class="error-message" *ngIf="phoneValid === false">
            ‚ùå Invalid phone number
          </div>
          
          <!-- Help text for mobile users -->
          <div class="help-text" *ngIf="!phoneChecking && phoneValid === null">
            <small>üì± Format: +63XXXXXXXXXX (10 digits after +63)</small>
          </div>
        </div>

        <!-- Address -->
        <div class="form-group">
          <input type="text" placeholder="Address" formControlName="address"
            (focus)="onFieldFocus('address')" (blur)="onFieldBlur('address')" (input)="onFieldChange('address')"
            (input)="capitalizeFirstLetter('address')"
            [class.error]="hasError('address')" [class.valid]="isValid('address')" />
          <div class="error-message" *ngIf="hasError('address')">{{ getErrorMessage('address') }}</div>
        </div>

        <!-- City -->
        <div class="form-group">
          <input type="text" placeholder="City" formControlName="city"
            (focus)="onFieldFocus('city')" (blur)="onFieldBlur('city')" (input)="onFieldChange('city')"
            (input)="capitalizeFirstLetter('city')"
            [class.error]="hasError('city')" [class.valid]="isValid('city')" />
          <div class="error-message" *ngIf="hasError('city')">{{ getErrorMessage('city') }}</div>
        </div>

        <!-- Postal Code -->
        <div class="form-group">
          <input type="text" placeholder="Postal Code (4 digits)" formControlName="postalCode"
            (focus)="onFieldFocus('postalCode')" (blur)="onFieldBlur('postalCode')" (input)="formatPostalCode($event)"
            maxlength="4"
            [class.error]="hasError('postalCode')" [class.valid]="isValid('postalCode')" />
          <div class="error-message" *ngIf="hasError('postalCode')">{{ getErrorMessage('postalCode') }}</div>
        </div>

        <!-- Special Request -->
        <div class="form-group">
          <textarea placeholder="Special Request (Optional)" formControlName="specialRequest"
            (focus)="onFieldFocus('specialRequest')" (blur)="onFieldBlur('specialRequest')" (input)="onFieldChange('specialRequest')"></textarea>
        </div>

        <!-- Consent Checkbox -->
        <div class="consent-checkbox">
          <input type="checkbox" formControlName="consentAccepted" (change)="onConsentChange()" />
          <span>
            I have read and agree to the 
            <strong class="policy-link" (click)="openPolicyModal()">Data Collection Policy</strong>
            and consent to the processing of my personal information.
          </span>
        </div>

        <!-- Buttons -->
        <div class="actions">
          <button type="button" (click)="back.emit()" class="btn-secondary">Back</button>
          <button type="submit" class="btn-primary" [disabled]="!isFormValid() || isFormProcessing()">
            <span *ngIf="isFormProcessing()">
              <i class="fa fa-spinner fa-spin"></i> Processing...
            </span>
            <span *ngIf="!isFormProcessing()">Submit Reservation</span>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>