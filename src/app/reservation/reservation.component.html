<app-terms-conditions-modal
  *ngIf="showPolicyModal"
  (closed)="closePolicyModal()">
</app-terms-conditions-modal>

<ng-container *ngIf="!showPolicyModal">

  <div class="top-bar">
    <button class="back-button" (click)="goToHome()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <h1 class="page-title">BC Flats</h1>
  </div>

  <div class="terms-disclaimer" *ngIf="!termsAccepted">
    <div class="terms-content">
      <h2>Terms and Conditions</h2>
      <p>Before proceeding with your reservation, make sure you  read and accept our terms and conditions:</p>

      <div class="terms-checkbox">
        <input type="checkbox" [(ngModel)]="termsChecked" />
        <span>
          I have read and agree to the
          <strong class="policy-link" (click)="openPolicyModal()">Terms and Conditions</strong>
        </span>
      </div>

      <div class="terms-actions">
        <button class="btn btn-primary" (click)="acceptTerms()" [disabled]="!termsChecked">
          Proceed
        </button>
      </div>
    </div>
  </div>

  <section class="progress" *ngIf="termsAccepted">
    <div class="progress_inner">
      <div *ngFor="let step of steps; index as i"
           class="progress_inner__step"
           [class.active]="currentStep === i + 1"
           [class.completed]="isStepCompleted(i + 1)"
           [class.disabled]="!canProceedToStep(i + 1) && currentStep < i + 1"
           (click)="goToStep(i + 1)"
           [style.cursor]="canProceedToStep(i + 1) ? 'pointer' : 'not-allowed'">
        <label>{{ step }}</label>
      </div>
      <div class="progress_inner__bar--set"></div>
      <div class="progress_inner__bar"
           [style.width.%]="(100 / steps.length) * (currentStep - 1)">
      </div>
      <div class="progress_inner__tabs">
        <div class="step-content">
          <ng-container [ngSwitch]="currentStep">
            <app-reservation-form
              *ngSwitchCase="1"
              (next)="handleReservationSubmitted($event)">
            </app-reservation-form>
            <app-availability
              *ngSwitchCase="2"
              (next)="handleRoomSelected($event)"
              (back)="goBack()">
            </app-availability>
            <app-process
              *ngSwitchCase="3"
              (next)="handleCustomerDetails($event)"
              (back)="goBack()">
            </app-process>
            <app-confirmation
              *ngSwitchCase="4"
              (back)="goBack()"
              (newReservation)="startNewReservation()">
            </app-confirmation>
          </ng-container>
        </div>
      </div>
    </div>
  </section>
</ng-container>